<div class="modal-header">
    <h3 class="modal-title">{{ addTitle }} team member</h3>
</div>
<div class="modal-body">
    <div ng-if="loading">
        <h1 class="text-center"><i class="icon fa-spinner fa-spin"></i></h1>
    </div>
    <div ng-if="!loading">
        <div class="form-group" ng-if="!editUser && users.length">
            <label class="control-label">User:</label>
            <ui-select ng-model="userModel.user" theme="bootstrap">
                <ui-select-match placeholder="Select user...">
                    {{ $select.selected.full_name || $select.selected.username }}
                </ui-select-match>
                <ui-select-choices repeat="user in users | filter: $select.search track by user.uuid">
                    <div>{{ ::user.full_name }}</div>
                    <small>
                        <div ng-if="::user.username">
                            Username: {{ ::user.username }}
                        </div>
                        <div ng-if="::user.email">
                            E-mail: {{ ::user.email }}
                        </div>
                        <div ng-if="::user.civil_number">
                            Civil number: {{ ::user.civil_number }}
                        </div>
                    </small>
                </ui-select-choices>
            </ui-select>
        </div>

        <p ng-if="!editUser && !users.length" class="text-danger">
            There are no available users.
        </p>

        <div class="form-group" ng-if="editUser">
            <p class="form-control-static">
                <strong>User:</strong>
               {{ editUser.full_name || user.username }}
            </p>
        </div>

        <div class="form-group">
            <div class="checkbox">
                <label>
                    <input type="checkbox"
                        ng-disabled="!canChangeRole"
                        ng-model="userModel.role"
                        ng-true-value="'Owner'"
                        ng-false-value="''">
                    </input>
                    Organization owner
                    <helpicon ng-if="!canChangeRole"
                        help-text="You cannot change your own role"></helpicon>
                </label>
            </div>
        </div>

        <div class="form-group" ng-if="!emptyProjectList">
            <label class="control-label">Project manager in:</label>
            <ui-select ng-model="userModel.projectsManagerRole"
                       on-remove="pushBackToProjectsList($item)"
                       on-select="refreshProjectChoices($select.search)"
                       theme="bootstrap"
                       multiple>
                <ui-select-match placeholder="Select projects...">
                    {{ $item.name }}
                </ui-select-match>
                <ui-select-choices multiple
                                   repeat="project in filteredProjects track by project.uuid"
                                   refresh="refreshProjectChoices($select.search)">
                    {{ project.name }}
                </ui-select-choices>
            </ui-select>
        </div>

        <div class="form-group" ng-if="!emptyProjectList">
            <label class="control-label">System administrator in:</label>
            <ui-select ng-model="userModel.projectsAdminRole"
                       on-remove="pushBackToProjectsList($item)"
                       on-select="refreshProjectChoices($select.search)"
                       theme="bootstrap"
                       multiple>
                <ui-select-match placeholder="Select projects...">
                    {{ $item.name }}
                </ui-select-match>
                <ui-select-choices multiple
                    repeat="project in filteredProjects track by project.uuid"
                    refresh="refreshProjectChoices($select.search)">
                    {{ project.name }}
                </ui-select-choices>
            </ui-select>
        </div>

        <p ng-if="emptyProjectList" class="text-danger">
            There are no available projects.
        </p>
    </div>
</div>
<div class="modal-footer">
    <button class="btn btn-primary"
       submit-button="saveUser()"
       ng-class="{'disabled': !editUser && !userModel.user}">
       {{ addText }}
    </button>
    <button class="btn btn-default"
        ng-click="$dismiss()">
        Cancel
    </button>
</div>
