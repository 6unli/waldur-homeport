<div ng-controller="InitialDataController as InitialData">
    <div class="initial-data-page">
        <div class="first-step">
            <h2>Welcome to NodeConductor, {{ InitialData.user.full_name }}!</h2>
            <p>Get your cloud expenses under control with just <b>1</b> click.</p>
            <div class="logo">
                <div class="img-wrapper">
                    <img gravatar-src="InitialData.user.email" alt=""/>
                </div>
                <span class="manage-gravatar">
                    Manage at
                    <a href="//gravatar.com" target="_blank">gravatar.com</a>
                </span>
                <div class="clear"></div>
            </div>
            <div class="fields">
                <label for="email">Email</label>
                <input id="email" type="text" ng-model="InitialData.user.email"/>
                <div class="error" ng-repeat="error in InitialData.user.errors" ng-bind="error"></div>
                <label for="customer_name">Organization name</label>
                <input id="customer_name" ng-model="InitialData.customer.name" type="text"/>
                <div class="error" ng-repeat="error in InitialData.customer.errors" ng-bind="error"></div>
            </div>
            <div class="clear"></div>
        </div>
        <aside>
            <p visible="plans">
                <span>You are on a forever free plan!</span><br/>
                If you need more analytical power please upgrade your plan later.
            </p>
            <div class="col initial-package" visible="plans" ng-if="InitialData.customer.plan">
                <span class="plan-name">Free plan</span>
                <div class="plan-item">
                    <table>
                        <tr ng-repeat="quota in InitialData.customer.plan.quotas" visible="{{ InitialData.getPrettyQuotaName(quota.name, quota.value) }}">
                            <td>{{ quota.value }} {{ InitialData.getPrettyQuotaName(quota.name, quota.value) }}</td>
                        </tr>
                    </table>
                </div>
            </div>
        </aside>
        <div class="second-step" ng-if="InitialData.servicesEnabled">
            <div visible="providers" ng-if="InitialData.loadingServices">
                <h2>
                    <i class="icon refresh spin"></i>
                    Loading providers
                </h2>
            </div>
            <div visible="providers" ng-if="!InitialData.loadingServices">
                <h2>Enter access codes</h2>
                <div class="fields-block state" ng-repeat="service in InitialData.chosenServices">
                    <div class="icon-block">
                        <img ng-src="/static/images/appstore/icon-{{ service.name.toLowerCase() }}.png"/>
                        <span>{{ service.name }}</span>
                        <a ui-sref="help.details({ name: service.name })" target="_blank" class="info">?</a>
                    </div>
                    <div ng-repeat="option in service.options" class="fields">
                        <label for="{{ ::option.$$hashKey }}">
                            <helpicon help-text="{{ option.help_text }}" ng-if="option.help_text"></helpicon>
                            {{ ::option.label }}
                            <input ng-if="::option.type == 'boolean'"
                                   type="checkbox"
                                   id="{{ ::option.$$hashKey }}"
                                   ng-model="option.value"/>
                        </label>
                        <span ng-if="option.type == 'string' || option.type == 'url'">
                            <input ng-if="!service.saved"
                                   ng-model="option.value"
                                   type="text"
                                   id="{{ ::option.$$hashKey }}"/>
                            <input ng-if="service.saved" disabled
                                   ng-model="option.value"
                                   type="text"
                                   id="{{ ::option.$$hashKey }}"/>
                        </span>
                        <select ng-if="option.choices"
                                ng-model="option.value"
                                ng-init="option.value=option.choices[0].value"
                                ng-options="item.value as item.display_name for item in option.choices"
                                id="{{ ::option.$$hashKey }}">
                        </select>
                        <div ng-if="::option.type == 'file upload'">
                          {{ InitialData.getFilename(option.value) || 'None'}}
                          <a class="button"
                             ngf-select
                             ngf-accept="'application/x-x509-ca-cert'"
                             ng-model="option.value">Browse</a>
                        </div>
                        <div class="error" ng-repeat="error in service.errors.data[option.key]" ng-bind="error"></div>
                    </div>
                    <div ng-if="service.saved" class="fields">
                        Provider is saved.
                    </div>
                    <div class="error fields" ng-repeat="error in service.errors.data.non_field_errors">
                        {{ error }}
                    </div>
                    <div class="clear"></div>
                    <span class="remove-service" ng-click="InitialData.removeService(service)">✖</span>
                </div>
                <div class="fields-block green">
                    <div class="select-block">
                        <label>Add another provider</label>
                        <select ng-model="InitialData.chosenService"
                                ng-options="key as key for (key, value) in InitialData.service_options">
                        </select>
                    </div>
                    <a class="button"
                       ng-class="{'disabled': !InitialData.chosenService}"
                       ng-click="InitialData.addChosenService()">Add provider</a>
                    <div class="clear"></div>
                </div>
                <div ng-show="InitialData.currentProcess" class="fields-block green light">
                    Current process: {{InitialData.currentProcess}}
                </div>
            </div>
            <div class="services-info-wrapper">
                <div class="services-info" ng-repeat="service in InitialData.chosenServices">
                    <div class="services-info-name">{{service.name}}</div>
                    <div class="services-info-status">
                        <a ng-class="InitialData.getClass(service.status)"
                           title="{{service.status}}"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="second-step">
            <div class="button-block" ng-if="!InitialData.loadingServices">
                <a class="button" submit-button="InitialData.save()">Let’s get started</a>
                <span>By continuing you agree to the <a ui-sref="tos.index" target="_blank">Terms of Provider</a>.</span>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</div>
