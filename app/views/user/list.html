<div ng-controller="UserListController as UserList">

    <div class="white-box">
        <ul class="sort-list">
            <li class="title">
                <h2 class="app-title">Users</h2>
            </li>
            <pagesize pages-list="UserList" pages-service="UserList.service"/></pagesize>
            <li class="search divid">
                <div class="search-box">
                    <input type="text" ng-model='UserList.searchInput' ng-change="UserList.search()">
                    <button class="search-button" ng-click="UserList.search()"></button>
                </div>
            </li>
            <li>
                <filter-list filter-controller="UserList"></filter-list>
            </li>
            <!--li class="right-sort">
                <a class="button">
                    <span class="icon plus"></span>
                    <span>Invite User</span>
                </a>
            </li -->
        </ul>
    </div>

    <!-- view-control -->
    <section class="view-control" ng-show="UserList.controlPanelShow">
        <div class="list-item no-cursor">
            <div class="checkbox">
                <div class="checkbox" ng-show="UserList.showgroup">
                    <input type="checkbox"
                        ng-checked="UserList.selectedInstances.length"
                        ng-click="UserList.changeAllSelectedInstances()">
                </div>
            </div>
            <div class="actions switch">
                <span class="label-text" ng-class="{'low-grade': !UserList.showgroup}">batch</span>
                <div class="checkbox-toggle">
                    <input type="checkbox" id="control-types" ng-click="UserList.showgroup=!UserList.showgroup">
                    <label for="control-types"></label>
                </div>
                <span class="label-text special-left" ng-class="{'low-grade': UserList.showgroup}">single</span>
            </div>
        </div>
    </section>
    <!-- /view-control -->

    <div class="white-box" ng-show="UserList.list.length > 0">
        <ul class="object-list">
            <li>
                <div class="list-item list-header">
                    <div class="checkbox"></div>
                    <div class="avatar"></div>
                    <div>
                        <a class="list-sort">Name</a>
                    </div>
                    <div class="additional-cell">
                        <a class="list-sort">E-mail</a>
                    </div>
                    <div class="additional-cell">
                        <a class="list-sort">Username</a>
                    </div>
                    <div class="actions"></div>
                </div>
            </li>
            <li ng-repeat="user in UserList.list">
                <div class="list-item list pointer"
                    ng-click="expandItem=!expandItem; UserList.showMore(user)">
                    <div class="checkbox">
                        <div class="checkbox" stoppropagation>
                            <input type="checkbox" ng-show="UserList.showgroup"
                                ng-checked="UserList.isInstanceSelected(user)"
                                ng-click="UserList.changeInstanceSelection(user)">
                        </div>
                    </div>
                    <div class="avatar">
                        <span class="avatar">
                            <img gravatar-src="user.email" gravatar-size="100" alt="" class="avatar-img">
                        </span>
                    </div>
                    <div class="name">
                        <h3 class="item-title">
                            <a ui-sref="users.details({uuid: user.uuid})" stoppropagation>{{ user.full_name }}</a>
                        </h3>
                    </div>
                    <div class="additional-cell">
                        {{ user.email }}
                    </div>
                    <div class="additional-cell">
                        {{ user.username }}
                    </div>
                    <div class="actions">
                        <!-- <action-button button-list="UserList.actionButtonsListItems"
                                       button-controller="UserList"
                                       ng-show="!UserList.showgroup"
                                       button-model="user"></action-button> -->
                    </div>
                </div>
                <div class="list-item-details" ng-show="expandItem" ng-class="{'opened': expandItem}">
                    <section class="on-mobile">
                        <header>
                            <h4 class="item-title">E-mail</h4>
                        </header>
                        {{ user.email }}
                    </section>
                    <section class="on-mobile">
                        <header>
                            <h4 class="item-title">Username</h4>
                        </header>
                        {{ user.username }}
                    </section>
                    <section detailscontent="checkbox avatar">
                        <header>
                            <h4 class="item-title">Connected projects</h4>
                            <minipagination page-models="UserList.userProjects"
                                            page-model-id="user.username"
                                            page-change="UserList.getProjectsForUser"
                                            page-entity-name="projects"></minipagination>
                        </header>
                        <ul ng-show="UserList.userProjects[user.username].data">
                            <li class="item-list">
                                <section>
                                    <a class="list-sort">Name</a>
                                </section>
                                <section>
                                    <div class="list-sort">Role</div>
                                </section>
                            </li>
                            <li class="item-list" ng-repeat="project in UserList.userProjects[user.username].data">
                                <section>
                                    <a ui-sref="projects.details({uuid: project.project_uuid})">{{ project.project_name }}</a>
                                </section>
                                <section>
                                    {{ project.role }}
                                </section>
                                <!-- TODO: enable and make it point to projects.details.permission tab --!>
                                <!-- a class="button inlist-action">Manage</a -->
                            </li>
                        </ul>
                        <article class="light-description">
                            To add this user to a new project, please <a ui-sref="projects.list">find it</a> and give user a role.
                        </article>
                    </section>
                </div>
            </li>
        </ul>
    </div>

    <div class="pagination">
        <pagination pages-list="UserList" pages-service="UserList.service"></pagination>
    </div>

</div>
