<div ng-if="$ctrl.loading">
    <h1 class="text-center"><i class="icon fa-spinner fa-spin"></i></h1>
</div>

<div class="ibox" ng-if="!$ctrl.loading && $ctrl.issue">
  <div class="ibox-content">
    <div class="row m-b-md">
      <div class="col-lg-12">
        <h2>{{ $ctrl.issue.key }}: {{ $ctrl.issue.summary }}</h2>
      </div>
    </div>
    <div class="row m-b-md">
      <dl class="dl-horizontal resource-details-table col-sm-12">
        <div class="m-b-xs">
          <dt>Caller:</dt>
          <dd>{{ ::$ctrl.issue.caller_full_name }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Reporter:</dt>
          <dd>{{ ::$ctrl.issue.reporter_name }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Assigned to:</dt>
          <dd>{{ ::$ctrl.issue.assignee_name || 'N/A' }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Organization:</dt>
          <dd>{{ ::$ctrl.issue.customer_name }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Issue type:</dt>
          <dd>{{ ::$ctrl.issue.type }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Project:</dt>
          <dd>{{ ::$ctrl.issue.project_name }}</dd>
        </div>

        <div class="m-b-xs" ng-if="::$ctrl.issue.resource_type">
          <dt>Scope:</dt>
          <dd>{{ ::$ctrl.issue.resource_type }}</dd>
        </div>

        <div class="m-b-xs" ng-if="::$ctrl.issue.resource_name">
          <dt>Affected resource:</dt>
          <dd>{{ ::$ctrl.issue.resource_name }}</dd>
        </div>

        <div class="m-b-xs">
          <dt>Status:</dt>
          <dd>{{ ::$ctrl.issue.status }}</dd>
        </div>

        <div class="m-b-xs" ng-if="::$ctrl.issue.resolution">
          <dt>Resolution:</dt>
          <dd>{{ ::$ctrl.issue.resolution }}</dd>
        </div>

        <div class="m-b-xs" ng-if="::$ctrl.issue.priority">
          <dt>Priority:</dt>
          <dd>{{ ::$ctrl.issue.priority }}</dd>
        </div>

        <div class="m-b-xs" ng-if="::$ctrl.issue.link">
          <dt>Link:</dt>
          <dd>
            <a href="{{ ::$ctrl.issue.link }}" class="btn btn-default" target="_blank">
              <i class="fa fa-external-link"></i>
              Open in JIRA
            </a>
          </dd>
        </div>

        <div class="m-b-xs">
          <dt>Created:</dt>
          <dd>
            <span am-time-ago="::$ctrl.issue.created"></span>,
            {{ ::$ctrl.issue.created | dateTime }}
          </dd>
        </div>
      </dl>

      <div class="col-sm-12">
        <h3>Description</h3>
        <p>{{ ::$ctrl.issue.description }}</p>
      </div>
    </div>
  </div>
</div>

<div class="ibox" ng-if="!$ctrl.loading && $ctrl.issue">
  <div class="ibox-title">
    <h4>Comments</h4>
  </div>
  <div class="ibox-content">
    <issue-comments-list issue="$ctrl.issue"></issue-comments-list>
    <issue-comments-form issue="$ctrl.issue" on-comment-created="$ctrl.onCommentCreated()"></issue-comments-form>
  </div>
</div>
