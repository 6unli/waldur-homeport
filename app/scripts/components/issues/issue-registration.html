<div class="ibox">
    <div class="ibox-content">
        <form class="form-horizontal" name="$ctrl.IssueForm" ng-disabled="$ctrl.saving">
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    Caller <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.caller" name="caller" required>
                        <ui-select-match placeholder="Select caller..."
                                         allow-clear="true">
                            {{ $select.selected.full_name || $select.selected.username }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.filterService.users"
                                           refresh="$ctrl.filterService.refreshUsers($select.search)"
                                           refresh-delay="0"
                                           spinner-enabled="true">
                            {{ option.full_name || option.username }}
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div class="col-sm-2 form-control-static" ng-if="$ctrl.issue.caller">
                    <a ng-click="$ctrl.openUserDialog($ctrl.issue.caller)">
                       Caller details
                    </a>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    Organization <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.customer" name="customer" required>
                        <ui-select-match placeholder="Select organization..."
                                         allow-clear="true">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.filterService.customers"
                                           refresh="$ctrl.filterService.refreshCustomers($select.search)"
                                           refresh-delay="0"
                                           spinner-enabled="true">
                            {{ option.name }}
                        </ui-select-choices>
                    </ui-select>
                </div>
                <div class="col-sm-2 form-control-static" ng-if="$ctrl.issue.customer">
                    <a ng-click="$ctrl.openCustomerDialog($ctrl.issue.customer)">
                       Organization details
                    </a>
                </div>
            </div>
            <div class="form-group">
                <label for="issueType" class="col-sm-3 control-label">
                    Issue type <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.type" name="type" required>
                        <ui-select-match placeholder="Select issue type..."
                                         allow-clear="true">
                            <i class="fa" ng-class="[$select.selected.iconClass, $select.selected.textClass]"></i>
                            {{ $select.selected.label }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.types">
                            <i class="fa" ng-class="[option.iconClass, option.textClass]"></i>
                            {{ option.label }}
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label for="issueSummary" class="col-sm-3 control-label">
                    Title <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <input type="text"
                        id="issueSummary"
                        ng-model="$ctrl.issue.summary"
                        class="form-control"
                        name="summary" required>
                </div>
            </div>
            <div class="form-group">
                <label for="issueDescription" class="col-sm-3 control-label">
                    Description <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <textarea type="text"
                        id="issueDescription"
                        ng-model="$ctrl.issue.description"
                        class="form-control"
                        name="description" required/>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    Project <span class='text-danger'>*</span>
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.project" name="project" required>
                        <ui-select-match placeholder="Select project..."
                                         allow-clear="true">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.filterService.projects"
                                           refresh="$ctrl.filterService.refreshProjects($select.search)"
                                           refresh-delay="0"
                                           spinner-enabled="true">
                            {{ option.name }}
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    Scope
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.scope">
                        <ui-select-match placeholder="Select scope...">
                            {{ $select.selected.label }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.scopes">
                            {{ option.label }}
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">
                    Affected resource
                </label>
                <div class="col-sm-7">
                    <ui-select ng-model="$ctrl.issue.resource">
                        <ui-select-match placeholder="Select affected resource..."
                                         allow-clear="true">
                            {{ $select.selected.name }}
                        </ui-select-match>
                        <ui-select-choices repeat="option in $ctrl.filterService.resources"
                                           refresh="$ctrl.filterService.refreshResources($select.search)"
                                           refresh-delay="0"
                                           spinner-enabled="true">
                            {{ option.name }}
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
        </form>
    </div>
    <div class="ibox-content text-right">
        <button class="btn btn-default" type="button" ng-click="$ctrl.onSearch({filter: $ctrl.issue})">
            <i class="fa fa-search"></i> Search
        </button>
        <button class="btn btn-primary" type="submit" submit-button="$ctrl.save()">
            <i class="fa fa-plus"></i> Create issue
        </button>
    </div>
</div>
