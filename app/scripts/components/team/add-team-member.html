<div class="modal-header">
    <h3 class="modal-title">{{ addTitle }} team member</h3>
</div>
<div class="modal-body">
    <div ng-if="loading">
        <h1 class="text-center"><i class="icon fa-spinner fa-spin"></i></h1>
    </div>
    <div ng-if="!loading" block-ui="add-team-member-dialog">
        <div class="form-group" ng-if="!editUser && users.length">
            <label class="control-label">User:</label>
            <user-selector users="users" model="userModel"></user-selector>
        </div>

        <p ng-if="!editUser && !users.length" class="text-danger">
            There are no available users.
        </p>

        <div class="form-group" ng-if="editUser">
            <p class="form-control-static">
                <strong>User:</strong>
                {{ editUser.full_name || editUser.username }}
            </p>
        </div>

        <div class="form-group">
            <div class="checkbox">
                <label>
                    <input type="checkbox"
                           ng-disabled="!canChangeRole"
                           ng-model="userModel.role"
                           ng-true-value="'owner'"
                           ng-false-value="''">
                    </input>
                    {{ ::roles.owner }}
                    <helpicon ng-if="!canChangeRole"
                              help-text="You cannot change your own role"></helpicon>
                </label>
            </div>
        </div>

        <div class="form-group" ng-if="!emptyProjectList">
            <label class="control-label">{{ ::roles.manager }} in:</label>
            <ui-select ng-model="userModel.projectsManagerRole"
                       on-remove="pushBackToProjectsList($item)"
                       on-select="refreshProjectChoices($select.search)"
                       theme="bootstrap"
                       multiple>
                <ui-select-match placeholder="Select projects...">
                    {{ $item.name }}
                </ui-select-match>
                <ui-select-choices multiple
                                   repeat="project in projects | filter: {'name': $select.search}"
                                   refresh="refreshProjectChoices($select.search)">
                    {{ project.name }}
                </ui-select-choices>
            </ui-select>
        </div>

        <div class="form-group" ng-if="!emptyProjectList">
            <label class="control-label">{{ ::roles.admin }} in:</label>
            <ui-select ng-model="userModel.projectsAdminRole"
                       on-remove="pushBackToProjectsList($item)"
                       on-select="refreshProjectChoices($select.search)"
                       theme="bootstrap"
                       multiple>
                <ui-select-match placeholder="Select projects...">
                    {{ $item.name }}
                </ui-select-match>
                <ui-select-choices multiple
                                   repeat="project in projects | filter: {'name': $select.search}"
                                   refresh="refreshProjectChoices($select.search)">
                    {{ project.name }}
                </ui-select-choices>
            </ui-select>
        </div>

        <p ng-if="emptyProjectList" class="text-danger">
            There are no available projects.
        </p>

        <action-field-datetime
                model="userModel"
                field="datetime">
        </action-field-datetime>

        <div class="error" ng-repeat="error in errors" ng-bind="error"></div>
    </div>
</div>
<div class="modal-footer">
    <button class="btn btn-primary"
            submit-button="saveUser()"
            ng-class="{'disabled': validateSubmit()}">
        {{ addText }}
    </button>
    <button class="btn btn-default"
            ng-click="$dismiss()">
        Cancel
    </button>
</div>
